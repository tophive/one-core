!function(l){l.fn.tophive_condition=function(c){var e=_.memoize(function(){var t={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e,n,a){return _.isUndefined(n)&&(n="tmpl-tophive-condition"),!_.isUndefined(a)&&_.isString(a)?t.variable=a:t.variable="data",_.template(l("#"+n).html(),null,t)(e)}});_.isUndefined(c)&&(c={});var s=(c=_.defaults(c,{ajax_url:!1,save_cb:!1,change_cb:!1})).ajax_url?c.ajax_url:ajaxurl,d=e(),n=function(o){var a={addPanel:function(){var e=d({},"tmpl-tophive-condition");o.html(e)},add_row:function(e){var a=this;_.isObject(e)||(e={});var n=d(e,"tmpl-tophive-condition-row"),t=l(n),i="_id"+(new Date).getTime();t.attr("id",i),l(".cond-list",o).append(t),l("select.cond-sub-id",t).select2({width:150,escapeMarkup:function(e){return e},ajax:{url:s,dataType:"json",data:function(e){var n;return(n=a.get_val(t)).search=e.term,n.action="tophive-pro/ajax/condition-data",n}}}),l("select.cond-sub-id",t).data("select2").on("open",function(e){this.results.clear(),this.dropdown._positionDropdown()}),l(".cond-lv-2 select",t).trigger("change")},get_val:function(e){var n=l(".cond-lv-1 select",e).val(),a=null,t=null,i=!1;switch(n){case"archive":a=l("select.cond--archive",e).val(),t=l("select.cond-sub-id").val();break;case"singular":a=l("select.cond--singular",e).val(),t=l("select.cond-sub-id",e).val()}a?(i=!0,-1<a.indexOf("post_type_archive/")&&(t=null,i=!1),-1!==a.indexOf("/")&&"general"!==a||(t=null,i=!1)):(t=null,i=!1),"general"===n&&(t=null,i=!1);var o="";if(i){var c=l("select.cond-sub-id",e).select2("data");_.isArray(c)&&0<_.size(c)&&(o=c[0].text)}return o||(t=""),{type:l("select.cond-type",e).val(),name:n,sub_name:a,sub_id:t,show_sub_id:i,sub_id_label:o}},conditions:function(){var a=this;o.on("change","select:not(.cond-sub-id, .cond-type)",function(){var e=l(this).closest(".cond-item"),n=a.get_val(e);switch(n.name?l(".cond-lv-2",e).removeClass("hide"):l(".cond-lv-2",e).addClass("hide"),n.name){case"archive":l("select.cond--singular",e).addClass("hide"),l("select.cond--archive",e).removeClass("hide");break;case"singular":l("select.cond--archive",e).addClass("hide"),l("select.cond--singular",e).removeClass("hide");break;default:l(".cond-lv-2",e).addClass("hide")}try{l("select.cond-sub-id",e).find("option").remove(),l("select.cond-sub-id",e).select2("change")}catch(e){}n.show_sub_id?l(".cond-lv-3",e).removeClass("hide"):l(".cond-lv-3",e).addClass("hide")})},save:function(){var n=[],a=this;l(".cond-item",o).each(function(e){n[e]=a.get_val(l(this))}),o.find(".cond-save").addClass("loading updating-message").text(OneCoreCustomizer_Conditional.l10n.loading);var t=l("input.cond-name",o).val()||"",i={action:"tophive-pro/ajax/condition-save",msid:OneCoreCustomizer_Conditional.id,title:t,conditionals:n,_nonce:OneCoreCustomizer_Conditional._nonce};l.ajax({url:s,type:"post",data:i,success:function(e){o.find(".cond-save").removeClass("loading updating-message").text(OneCoreCustomizer_Conditional.l10n.save),l('.li-boxed[data-id="'+OneCoreCustomizer_Conditional.id+'"] .li-boxed-label').text(t),"function"==typeof c.save_cb&&c.save_cb(e,i)}}),console.log("save_value",n)}};return a.addPanel(),0<_.size(OneCoreCustomizer_Conditional.conditionals)&&_.each(OneCoreCustomizer_Conditional.conditionals,function(e){a.add_row(e)}),a.conditions(),o.on("click",".cond-add",function(e){e.preventDefault(),a.add_row()}),o.on("click",".cond-remove",function(e){e.preventDefault(),l(this).closest(".cond-item-wrapper").remove()}),o.on("click",".cond-save",function(e){e.preventDefault(),l(this).hasClass("loading")||a.save()}),o.bind("change","input select textarea",function(e){if("function"==typeof c.change_cb){var n=[];l(".cond-item",o).each(function(e){n[e]=a.get_val(l(this))}),c.change_cb(n)}}),a};return this.each(function(){return new n(l(this))})}}(jQuery);